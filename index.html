<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Froot · Marina Color-Breath</title>
<meta name="description" content="Froot — Marina color-breath practice. Select a Froot to shape the silky 128 Hz Honey core: Muse flutter, Chorus micro-detune, and gentle filters. Mobile-clean, linked ribbon." />
<meta name="theme-color" content="#0b0d11" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#0b0d11">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{
    --bg:#0b0d11; --ink:#ecf1f9; --muted:#aeb4c4; --ring:#1a2236; --card:#0f1427;
    --aqua:#b5f0ea; --honey:#ffd37a; --rose:#ff9bb0; --emerald:#8be0b7; --violet:#c9a7ff; --gold:#f6d28b; --peach:#ffb38a;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:radial-gradient(1200px 700px at 50% -10%, #141736 0%, #0b0d11 38%, #0b0d11 100%);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:920px;margin:0 auto;padding:16px 16px 80px}

  header{padding:12px 16px 0}
  .brand{display:flex;align-items:center;gap:10px}
  .glyph{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#1b2337,#0f1220);display:grid;place-items:center;box-shadow:inset 0 0 0 1px #222b46}
  .glyph span{font-size:16px}
  h1{font-size:18px;margin:0 0 6px 0}
  .tag{font-size:12px;color:#c9d1e2}

  .ribbon{
    margin:10px 0 8px;display:flex;gap:8px;overflow:auto;padding-bottom:2px;
    -webkit-overflow-scrolling:touch;scrollbar-width:none
  }
  .ribbon::-webkit-scrollbar{display:none}
  .chip{
    white-space:nowrap;font-size:13px;padding:8px 12px;border-radius:999px;flex:0 0 auto;
    background:#121a34;border:1px solid #2a3457;color:#e5ebfb
  }
  .chip[data-hi="1"]{border-color:#75421f;background:#23140a}

  .card{
    background:linear-gradient(180deg,#0f1427 0%, #0b0f1e 100%);border:1px solid var(--ring);
    border-radius:14px;padding:14px;box-shadow:0 10px 28px #0007;margin:12px 0;position:relative
  }
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

  .grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:740px){ .grid{grid-template-columns:repeat(3,1fr)} }

  .pill,button{
    appearance:none;border:1px solid #2a3457;background:#121a34;color:var(--ink);
    padding:10px 14px;border-radius:999px;font-weight:600;letter-spacing:.2px
  }
  button:active{transform:translateY(1px)}
  .on{background:linear-gradient(90deg,#3a2a12,#241707);border-color:#5e3f1d;box-shadow:0 0 0 1px #523410 inset, 0 0 20px #2b1a08}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#121a34;border:1px solid #2a3457;font-size:13px}
  label{font-size:13px;color:var(--muted)}
  input[type="range"]{width:100%}
  .note{font-size:14px;color:#cfd6ea}
  .soft{color:#b0b6c8}
  .footer{opacity:.9;text-align:center;font-size:12px;color:#aab1c6;margin-top:10px}

  .meter{height:8px;background:#0e1326;border:1px solid #1f2744;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--honey),var(--rose),var(--aqua));transition:width .35s ease}

  .fruit{
    display:flex;flex-direction:column;gap:8px;border:1px solid var(--ring);border-radius:12px;
    padding:12px;background:linear-gradient(180deg,#111633 0%, #0c0f22 100%);box-shadow:0 8px 22px #0007
  }
  .fruit .title{display:flex;align-items:center;gap:8px;font-weight:700}
  .fruit .desc{font-size:13px;color:#cfd6ea}
</style>
</head>
<body>
  <header class="wrap" aria-label="Site header">
    <div class="brand">
      <div class="glyph"><span>🍉</span></div>
      <div>
        <h1>Froot · <span style="text-shadow:0 0 14px #ffd37a77">Marina Color-Breath</span></h1>
        <div class="tag">Silky 128 Hz Honey core · Muse flutter · Chorus micro-detune · color shapers</div>
      </div>
    </div>

    <nav class="ribbon" aria-label="Sites">
      <a class="chip" href="https://mirrorhoney.plnt.earth/">MirrorHoney</a>
      <a class="chip" href="https://earth.plnt.earth/">Earth</a>
      <a class="chip" href="https://honey.plnt.earth/">Honey</a>
      <a class="chip" href="https://mask.plnt.earth/">Mask</a>
      <a class="chip" href="https://voice.plnt.earth/">Voice</a>
      <a class="chip" href="https://jar.plnt.earth/">Jar</a>
      <a class="chip" data-hi="1" href="https://froot.plnt.earth/">Froot</a>
      <a class="chip" href="https://tunes.plnt.earth/">Tunes</a>
      <a class="chip" href="https://bridge.plnt.earth/">Bridge</a>
    </nav>
  </header>

  <main class="wrap" id="main">
    <!-- Honey Core Controls -->
    <section class="card" aria-label="Honey core">
      <div class="row" style="justify-content:space-between;gap:10px">
        <div class="badge">🍯 Honey Core — 128 Hz</div>
        <div class="badge">Status: <strong id="statusText">Off</strong></div>
      </div>

      <div class="row" style="margin-top:8px;gap:10px;flex-wrap:wrap">
        <button id="startBtn" class="pill">▶︎ Start Honey</button>
        <button id="stopBtn"  class="pill">■ Stop</button>
        <button id="museBtn"  class="pill" aria-pressed="false">○ Muse: Off</button>
        <button id="chorusBtn" class="pill" aria-pressed="false">○ Chorus: Off</button>
      </div>

      <div class="row" style="margin-top:8px;gap:10px;flex-wrap:wrap">
        <label for="volume">Level</label>
        <input id="volume" type="range" min="0" max="100" value="60" step="1" />
        <label for="detune">Fine Detune (±2%)</label>
        <input id="detune" type="range" min="-2" max="2" value="0" step="0.01" />
      </div>

      <div class="meter" style="margin-top:10px"><div class="bar" id="meterBar"></div></div>

      <p class="note" style="margin-top:10px">
        Tap <b>Start Honey</b> once on iPhone to unlock audio. <b>Muse</b> adds a slow flutter (±8¢). <b>Chorus</b> splits L/R a few cents for a dreamy glow.
        Use <b>Fine Detune</b> to find your “click.” When the chest warms, pick a Froot below.
      </p>
    </section>

    <!-- Froot Grid -->
    <section class="card" aria-label="Froot modes">
      <div class="badge">🎨 Select a Froot</div>
      <div class="grid" style="margin-top:10px">
        <div class="fruit" data-froot="peach">
          <div class="title" style="color:var(--peach)">🍑 Peach — Ease</div>
          <div class="desc">Warm low-mid hug. Soft low-pass + tiny presence. For safety and “I belong.”</div>
          <button class="pill set-froot">Use Peach</button>
        </div>
        <div class="fruit" data-froot="nectar">
          <div class="title" style="color:var(--honey)">🍯 Nectar — Magnet</div>
          <div class="desc">Bright allure. High-shelf lift + light shimmer. For charm, sweetness, invitation.</div>
          <button class="pill set-froot">Use Nectar</button>
        </div>
        <div class="fruit" data-froot="emerald">
          <div class="title" style="color:var(--emerald)">💚 Emerald — Calm Power</div>
          <div class="desc">Balanced clarity. Gentle band-pass to center the voice. For steady confidence.</div>
          <button class="pill set-froot">Use Emerald</button>
        </div>
        <div class="fruit" data-froot="violet">
          <div class="title" style="color:var(--violet)">🔮 Violet — Mystery</div>
          <div class="desc">Air + space. Subtle high lift and chorus depth. For dream logic and intuition.</div>
          <button class="pill set-froot">Use Violet</button>
        </div>
        <div class="fruit" data-froot="gold">
          <div class="title" style="color:var(--gold)">🌼 Gold — Radiance</div>
          <div class="desc">Open and strong. Wide band + soft harmonics. For announcement without strain.</div>
          <button class="pill set-froot">Use Gold</button>
        </div>
      </div>
    </section>

    <!-- Gentle guidance -->
    <section class="card" aria-label="How to use">
      <div class="badge">📝 How to use Froot</div>
      <p class="note">
        1) Start Honey and breathe. 2) Nudge detune until your exhale feels effortless. 3) Pick a Froot that matches your moment.  
        Ship one tiny act that matches the feeling (a line, a tweak, a message). Return daily — rhythm > scale.
      </p>
      <p class="soft">
        Need school tools? <a href="https://jar.plnt.earth/">Jar</a> · <a href="https://jar.plnt.earth/school.html">School</a> · <a href="https://jar.plnt.earth/school-rooms.html">School Rooms</a> · Playlists at <a href="https://tunes.plnt.earth/">Tunes</a> · Reflection at <a href="https://mirrorhoney.plnt.earth/">MirrorHoney</a>.
      </p>
    </section>

    <div class="footer">Night-safe UI · zero-network WebAudio · smooth ramps · no overlays.</div>
  </main>

<script>
(() => {
  // UI
  const statusText  = document.getElementById('statusText');
  const startBtn    = document.getElementById('startBtn');
  const stopBtn     = document.getElementById('stopBtn');
  const museBtn     = document.getElementById('museBtn');
  const chorusBtn   = document.getElementById('chorusBtn');
  const vol         = document.getElementById('volume');
  const det         = document.getElementById('detune');
  const meterBar    = document.getElementById('meterBar');
  const frootBtns   = [...document.querySelectorAll('.set-froot')];

  // WebAudio: osc -> (panner for chorus) -> filters -> gain -> out
  let ctx, oscL, oscR, merger, gain, shelf, lpf, bpf;
  let lfo, lfoGain; // Muse (detune flutter)
  let on=false, muse=false, chorus=false;

  function ensureCtx(){
    if(!ctx){
      ctx = new (window.AudioContext || window.webkitAudioContext)({latencyHint:'playback'});
      gain = ctx.createGain(); gain.gain.value = 0.0001;

      // Dual oscillators for chorus (L/R); default route both center
      oscL = ctx.createOscillator(); oscL.type='sine'; oscL.frequency.value = 128;
      oscR = ctx.createOscillator(); oscR.type='sine'; oscR.frequency.value = 128;

      const panL = new StereoPannerNode(ctx,{pan:-0.4});
      const panR = new StereoPannerNode(ctx,{pan: 0.4});

      // Filters
      shelf = ctx.createBiquadFilter(); shelf.type='highshelf'; shelf.frequency.value=2500; shelf.gain.value=0;
      lpf   = ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=20000; // open
      bpf   = ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=700; bpf.Q.value=0.0001; // effectively bypass

      // Chain: (L->panL) + (R->panR) -> shelf -> lpf -> bpf -> gain -> out
      oscL.connect(panL); oscR.connect(panR);
      const sum = ctx.createGain(); panL.connect(sum); panR.connect(sum);
      sum.connect(shelf); shelf.connect(lpf); lpf.connect(bpf); bpf.connect(gain); gain.connect(ctx.destination);

      // Muse LFO (modulates detune in cents on L channel for slight movement)
      lfo = ctx.createOscillator(); lfo.type='sine'; lfo.frequency.value = 0.15; // ~6-7s
      lfoGain = ctx.createGain(); lfoGain.gain.value = 0; // cents depth
      lfo.connect(lfoGain);
      lfoGain.connect(oscL.detune);
      lfo.start();

      oscL.start(); oscR.start();
    }
  }

  function setBadge(v){ statusText.textContent = v ? 'On' : 'Off'; startBtn.classList.toggle('on', v); }
  function setToggle(btn, v, onLabel, offLabel){
    btn.textContent = v ? onLabel : offLabel;
    btn.setAttribute('aria-pressed', v ? 'true' : 'false');
    btn.classList.toggle('on', v);
  }

  function rampGain(target, ms){
    if(!gain) return;
    const now = ctx.currentTime, dur = Math.max(0.06,(ms||250)/1000);
    const current = gain.gain.value;
    gain.gain.cancelScheduledValues(now);
    gain.gain.setValueAtTime(current, now);
    gain.gain.linearRampToValueAtTime(target, now + dur);

    // UI meter
    const start = parseFloat(meterBar.style.width)||0;
    const end = Math.round(Math.min(100, Math.max(0, target*100)));
    const t0 = performance.now(), T = Math.max(60,(ms||250));
    function step(ts){
      const k = Math.min(1,(ts - t0)/T);
      meterBar.style.width = Math.round(start + (end-start)*k) + '%';
      if(k<1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  function level(){ return Math.min(1, Math.max(0, vol.value/100)); }

  function applyFineDetune(){
    if(!oscL||!oscR) return;
    const pct = parseFloat(det.value)||0;   // ±2%
    const cents = pct * 20;                 // keep within ±40 cents feel
    oscL.detune.setTargetAtTime(cents + (chorus ? -6 : 0), ctx.currentTime, 0.05);
    oscR.detune.setTargetAtTime(cents + (chorus ?  +6 : 0), ctx.currentTime, 0.05);
  }

  function toggleMuse(){
    muse = !muse;
    setToggle(museBtn, muse, '● Muse: On', '○ Muse: Off');
    if(!ctx) return;
    const depth = muse ? 8 : 0; // cents
    lfoGain.gain.setTargetAtTime(depth, ctx.currentTime, 0.2);
  }

  function toggleChorus(){
    chorus = !chorus;
    setToggle(chorusBtn, chorus, '● Chorus: On', '○ Chorus: Off');
    applyFineDetune();
  }

  function setFroot(name){
    if(!ctx) return;
    // Reset to neutral
    shelf.gain.setTargetAtTime(0, ctx.currentTime, 0.1);
    lpf.frequency.setTargetAtTime(20000, ctx.currentTime, 0.1);
    bpf.Q.setTargetAtTime(0.0001, ctx.currentTime, 0.1);
    bpf.frequency.setTargetAtTime(700, ctx.currentTime, 0.1);

    // Apply color voicings
    if(name==='peach'){
      lpf.frequency.setTargetAtTime(1800, ctx.currentTime, 0.2);
      shelf.gain.setTargetAtTime(1.5, ctx.currentTime, 0.2);
      chorus = false; setToggle(chorusBtn, false, '● Chorus: On', '○ Chorus: Off'); applyFineDetune();
    }else if(name==='nectar'){
      shelf.gain.setTargetAtTime(5, ctx.currentTime, 0.2);
      lpf.frequency.setTargetAtTime(12000, ctx.currentTime, 0.2);
      if(!chorus){ toggleChorus(); } // light glow
    }else if(name==='emerald'){
      bpf.frequency.setTargetAtTime(650, ctx.currentTime, 0.2);
      bpf.Q.setTargetAtTime(0.8, ctx.currentTime, 0.2);
      shelf.gain.setTargetAtTime(2.0, ctx.currentTime, 0.2);
      chorus = false; setToggle(chorusBtn, false, '● Chorus: On', '○ Chorus: Off'); applyFineDetune();
    }else if(name==='violet'){
      shelf.gain.setTargetAtTime(3.5, ctx.currentTime, 0.2);
      if(!chorus){ toggleChorus(); }
      if(!muse){ toggleMuse(); }
    }else if(name==='gold'){
      shelf.gain.setTargetAtTime(4.0, ctx.currentTime, 0.2);
      lpf.frequency.setTargetAtTime(16000, ctx.currentTime, 0.2);
      if(!chorus){ toggleChorus(); }
      if(muse){ toggleMuse(); } // crisp, less flutter
    }
  }

  async function start(){
    ensureCtx();
    if(on) return;
    if(ctx.state === 'suspended'){ try{ await ctx.resume(); }catch(_){ } }
    applyFineDetune();
    rampGain(level(), 420);
    on = true; setBadge(true);
  }

  function stop(){
    if(!ctx || !on) return;
    rampGain(0.0001, 300);
    on = false; setBadge(false);
  }

  // Bindings
  startBtn.addEventListener('click', start);
  stopBtn .addEventListener('click', stop);
  museBtn .addEventListener('click', toggleMuse);
  chorusBtn.addEventListener('click', toggleChorus);

  vol.addEventListener('input', () => { if(ctx){ rampGain(level(), 140); } });
  det.addEventListener('input', applyFineDetune);

  frootBtns.forEach(b=>{
    b.addEventListener('click', e=>{
      const card = e.currentTarget.closest('.fruit');
      const name = card?.getAttribute('data-froot');
      if(name){ setFroot(name); }
    });
  });

  document.addEventListener('visibilitychange', () => setBadge(on && !document.hidden));

  // Init UI
  setBadge(false);
  setToggle(museBtn,false,'● Muse: On','○ Muse: Off');
  setToggle(chorusBtn,false,'● Chorus: On','○ Chorus: Off');
  meterBar.style.width = vol.value + '%';
})();
</script>
</body>
</html>
