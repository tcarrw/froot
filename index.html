<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>froot.plnt.earth — χ Palettes + Video (v1.4.3)</title>
<meta name="description" content="Froot — feel the χ-field as color palettes, tones, micro-rituals and clean tinted video cards. Tabs for Marina, Sigrid, Sabrina, Swift, Ariana, Doechii, plus Flow. Single player, looped queue, Illumina week-aware." />
<meta name="color-scheme" content="dark light" />
<meta name="theme-color" content="#0b1020" />
<!--
File: /index.html
Version: v1.4.3
Key:
 • Mode toggle: FLOW (all anchors) vs SPOTLIGHT (per-week owner)
 • Single YouTube IFrame API player, looped playlist, exposed controls
 • Track Picker select to jump; Open in YouTube follows current
 • No inline video iframes in cards (one player only)
 • Tones reliable on desktop/mobile; AirPlay-safe routing
-->

<!-- Connection warm-ups -->
<link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>
<link rel="preconnect" href="https://i.ytimg.com" crossorigin>

<style>
:root{
  --bg:#0a1020; --bg2:#111a34; --panel:#10162a;
  --ink:#e9ecf5; --ink-dim:#bac2d6; --ink-soft:#93a0bf;
  --accent:#8cc7ff; --accent-2:#7ef7a6; --callout:#152245;
  --border:#23305a; --shadow:0 12px 40px rgba(0,0,0,.35);
  --radius:16px; --maxw:1000px; --header-h:56px;
  --tint: rgba(0,0,0,0); --tintOpacity: .35;
  --grad: radial-gradient(1200px 600px at 10% -10%, #132650 0%, transparent 60%),
          radial-gradient(1200px 600px at 110% -10%, #301a5d 0%, transparent 60%),
          linear-gradient(180deg, #0a1020 0%, #111a34 60%, #0e1428 100%);
}
@media (min-width:980px){:root{--header-h:64px}}
@media (prefers-color-scheme: light){
  :root{
    --bg:#f5f7fb; --bg2:#edf1f8; --panel:#ffffff;
    --ink:#12131b; --ink-dim:#2a2f42; --ink-soft:#5a6280;
    --accent:#165dff; --accent-2:#17a05d; --callout:#eaf2ff;
    --border:#e2e7f0; --shadow:0 12px 40px rgba(0,0,0,.12);
    --grad: linear-gradient(180deg,#f7f9ff 0%,#eef3ff 60%,#e9effb 100%);
  }
}
*{box-sizing:border-box}
html,body{
  margin:0; padding:0; background:var(--bg); color:var(--ink);
  font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Arial,Apple Color Emoji,Segoe UI Emoji;
  line-height:1.5; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  background-image: var(--grad);
}
h1,h2{ font-family: ui-serif, "Georgia", "Times New Roman", serif }

/* header */
header.site{
  position:sticky; top:0; z-index:60;
  background: color-mix(in oklab,var(--bg2) 90%, transparent);
  backdrop-filter:saturate(120%) blur(8px);
  border-bottom:1px solid var(--border);
  block-size:calc(var(--header-h)+env(safe-area-inset-top));
  padding-top:env(safe-area-inset-top)
}
.site-inner{max-width:var(--maxw); margin:0 auto; padding:8px 20px; block-size:calc(var(--header-h));
  display:flex; align-items:center; gap:12px}
.brand{display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.3px; white-space:nowrap}
.dot{inline-size:10px; block-size:10px; border-radius:50%; background:var(--accent);
  box-shadow:0 0 24px color-mix(in oklab,var(--accent)70%,transparent)}
.spacer{flex:1}
.btn{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px;
  background:var(--panel); color:var(--ink); border:1px solid var(--border); box-shadow:var(--shadow);
  text-decoration:none; font-weight:700; font-size:13px; white-space:nowrap}
.btn.secondary{ background:color-mix(in oklab, var(--panel) 70%, var(--bg2) 30%) }

.wrap{max-width:var(--maxw); margin:0 auto;
  padding:calc(var(--header-h)+env(safe-area-inset-top)+14px) 20px 160px}
.hero{position:relative; border:1px solid var(--border); border-radius:var(--radius);
  padding:22px; box-shadow:var(--shadow); overflow:hidden;
  background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 80%, transparent), transparent 60%)}
.tint{position:absolute; inset:0; pointer-events:none; mix-blend-mode:soft-light; background:var(--tint); opacity:var(--tintOpacity)}
h1{font-size:clamp(28px,3.2vw,40px); margin:0 0 8px}
.sub{color:var(--ink-soft); font-size:clamp(14px,2vw,16px)}
.badges{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
.badge{font-size:12px; color:var(--ink-soft); background:color-mix(in oklab,var(--panel) 70%, var(--bg2) 30%);
  border:1px solid var(--border); padding:6px 10px; border-radius:999px}

/* ground/feel */
.ground{position:absolute; top:12px; right:12px; display:flex; align-items:center; gap:10px; z-index:2; user-select:none}
.dotegg{inline-size:18px; block-size:18px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #334, #000);
  border:1px solid var(--border); box-shadow:0 0 0 2px rgba(0,0,0,.2) inset, 0 0 20px rgba(0,0,0,.25); cursor:pointer}
.dotegg.on{background:radial-gradient(circle at 30% 30%, #b6ffd1, #2cff7b); box-shadow:0 0 0 2px rgba(0,0,0,.2) inset, 0 0 28px rgba(46,255,123,.45)}
.gtext{font-size:12px; color:var(--ink-soft)}

/* tabs + controls */
.tabs{margin-top:18px; display:flex; gap:8px; flex-wrap:wrap}
.tab{padding:8px 12px; border-radius:999px; border:1px solid var(--border);
  background:var(--panel); color:var(--ink-soft); font-weight:700; cursor:pointer; user-select:none}
.tab.active{color:var(--ink); background:var(--bg2)}
.controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:14px}
.chip{display:inline-flex; align-items:center; gap:8px; padding:7px 10px; background:var(--bg2);
  border:1px solid var(--border); border-radius:999px; font-size:12px; color:var(--ink-soft)}
.switch{display:inline-flex; gap:8px; align-items:center}
.switch button{padding:7px 10px; border-radius:10px; border:1px solid var(--border);
  background:var(--panel); color:var(--ink); font-weight:700; cursor:pointer}
.switch button.active{ background:var(--bg2) }
.start{padding:10px 14px; border-radius:12px; border:1px solid var(--border);
  background:var(--accent); color:#001; font-weight:900; cursor:pointer}
.range{display:inline-flex; align-items:center; gap:8px}
.range input{width:140px}

/* grid + cards */
.grid{display:grid; grid-template-columns:1fr; gap:18px; margin-top:18px}
section.card{background:var(--panel); border:1px solid var(--border);
  border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
section.card h2{margin:0 0 10px; font-size:22px}

/* palettes */
.palette{display:grid; grid-template-columns:repeat(6,1fr); gap:8px; margin-top:10px}
.sw{border:1px solid var(--border); border-radius:12px; overflow:hidden; position:relative; min-height:64px; cursor:pointer}
.sw>span{position:absolute; left:8px; bottom:6px; font-size:11px; font-weight:800; color:#000; text-shadow:0 1px 2px rgba(255,255,255,.6)}
.mini{font-size:12px; opacity:.9}
.ritual{background:var(--bg2); border:1px solid var(--border); border-radius:12px; padding:12px; margin-top:10px; font-size:14px}
.cchip{display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid var(--border);
  background:var(--bg2); font-size:11px; margin-left:6px; cursor:pointer}

/* videos (cards only show thumbs; click manipulates the single player) */
.videos{display:grid; grid-template-columns:1fr; gap:14px; margin-top:10px}
.vcard{position:relative; border:1px solid var(--border); border-radius:16px; overflow:hidden; background:#000; box-shadow:var(--shadow)}
.thumb{position:relative; aspect-ratio:16/9; background:#000 center/cover no-repeat}
.vlabel{position:absolute; left:10px; bottom:8px; right:10px;
  display:flex; justify-content:space-between; align-items:center; gap:10px;
  font-size:12px; font-weight:800; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.7)}
.setqueue,.playfirst{padding:8px 10px; border-radius:999px; background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.25); color:#fff; font-weight:900}

/* Queue Strip */
.queuestrip{
  position:sticky; top:calc(var(--header-h) + 14px + env(safe-area-inset-top));
  z-index:40; margin-top:14px; padding:10px; border:1px solid var(--border); border-radius:var(--radius);
  background:color-mix(in oklab, var(--panel) 85%, transparent); backdrop-filter:blur(6px);
}
.qhdr{display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-bottom:8px; color:var(--ink-soft); font-size:12px}
.qrow{display:flex; gap:10px; overflow:auto; scroll-snap-type:x mandatory; padding-bottom:6px}
.qtile{flex:0 0 62%; max-width:62%; aspect-ratio:16/9; background:#000 center/cover no-repeat;
  border-radius:14px; border:1px solid var(--border); position:relative; scroll-snap-align:center; box-shadow:var(--shadow); cursor:pointer}
.qtile.small{flex-basis:40%; max-width:40%}
.qtile::after{content:attr(data-label); position:absolute; left:8px; bottom:6px; right:8px; font-size:12px; font-weight:900; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.7)}
.qmeta{display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between; margin-top:6px; font-size:12px; color:var(--ink-soft)}
.qmeta .btn{padding:6px 10px; font-size:12px}
.select{padding:6px 10px; border:1px solid var(--border); border-radius:10px; background:var(--panel); color:var(--ink); font-weight:600}

/* player bar */
.playerbar{
  position:fixed; left:0; right:0; bottom:0; z-index:70;
  background: color-mix(in oklab, var(--panel) 70%, var(--bg2) 30%);
  border-top:1px solid var(--border);
  box-shadow:0 -10px 30px rgba(0,0,0,.35);
}
.player-inner{ max-width:var(--maxw); margin:0 auto; padding:8px 12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap }
.player-title{ font-size:13px; color:var(--ink-soft) }
.player-iframe{ flex:1; min-height:56px }
#ytframe{ width:100%; height:56px; border:0; }
.pbtn{ padding:6px 10px; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--ink); font-weight:800; cursor:pointer }
.pulse{ inline-size:10px; block-size:10px; border-radius:50%; background:#999; margin-left:6px; box-shadow:0 0 0 0 rgba(140,199,255,.0) }
.pulse.on{ background:var(--accent-2); animation: pulser 1.2s ease-in-out infinite }
@keyframes pulser{0%{box-shadow:0 0 0 0 rgba(140,199,255,.6)}70%{box-shadow:0 0 0 10px rgba(140,199,255,.0)}100%{box-shadow:0 0 0 0 rgba(140,199,255,.0)}}

.footer{margin-top:28px; color:var(--ink-soft); font-size:14px; display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center}
.links{display:flex; gap:10px; flex-wrap:wrap}

@media(max-width:420px){
  :root{--header-h:44px}
  .site-inner{padding:6px 12px; gap:8px}
  .btn{padding:6px 10px; font-size:12px; border-radius:8px}
  .hero{padding:16px}
  section.card{padding:16px}
  .qtile{flex-basis:85%; max-width:85%}
}
@media print{
  header.site,.tabs,.controls,.footer,.badges,.ground,.playerbar,.queuestrip{display:none!important}
  .wrap{padding:0} section.card{break-inside:avoid} body{background:#fff}
}

/* moon-phase theme */
body[data-phase="seed"] .tint{opacity:.25; filter:saturate(.9)}
body[data-phase="grow"] .tint{opacity:.35; filter:saturate(1.05)}
body[data-phase="mirror"] .tint{opacity:.5;  filter:saturate(1.2)}
body[data-phase="integrate"] .tint{opacity:.32; filter:saturate(1)}
body[data-phase="rest"] .tint{opacity:.22; filter:grayscale(.15)}
</style>

<!-- phase loader -->
<script>
(function(){
  function setPhase(c){
    try{
      var s=new Date(c.illumina.start+"T00:00:00"),n=new Date();
      var d=Math.floor((n-s)/(1000*60*60*24))+1,p='rest';
      if(d<=0)p='seed'; else if(d<=20)p='grow'; else if(d===21)p='mirror'; else if(d<=41)p='integrate'; else p='rest';
      document.body.dataset.phase=p;
      var cyc=c.illumina,b=document.getElementById('cycleBanner');
      if(b)b.textContent="Illumina "+cyc.cycle_number+" • "+cyc.start+" – "+cyc.end+" • Week "+computeWeekNumber(d);
      window._FROOT_CYCLE_DAY = d; window._FROOT_PHASE = p;
    }catch(e){}
  }
  fetch('/data/calendar.json').then(r=>r.json()).then(setPhase).catch(function(){});
})();
function computeWeekNumber(day){
  if(day<=0) return 0;
  if(day<=7) return 1; if(day<=14) return 2; if(day<=21) return 3;
  if(day<=28) return 4; if(day<=35) return 5; if(day<=42) return 6;
  return 6;
}
</script>
</head>

<body>
<header class="site" aria-label="Site Header">
  <div class="site-inner">
    <div class="brand"><span class="dot"></span><span>froot.plnt.earth — χ Palettes</span></div>
    <div class="spacer"></div>
    <a class="btn secondary" href="https://time.plnt.earth" target="_blank" rel="noopener">χ Calibrated</a>
    <a class="btn" href="https://github.com/tcarrw/time" target="_blank" rel="noopener">GitHub: tcarrw/time</a>
  </div>
</header>

<main class="wrap">
  <div class="hero">
    <div class="tint" aria-hidden="true"></div>
    <div class="ground">
      <button class="dotegg" id="groundDot" title="Tap 10× or complete a breath cycle / feel test to light"></button>
      <span class="gtext" id="gstatus">Ground Check: off</span>
    </div>
    <h1>Feel χ as Color</h1>
    <div class="sub">
      FLOW = everyone together • SPOTLIGHT = one anchor per week.<br>
      <strong>Tap any video card to push it to the top of the single player queue.</strong>
      <span class="mini" id="cycleBanner" style="display:block;margin-top:6px;color:var(--ink-soft)"></span>
    </div>
    <div class="badges">
      <span class="badge">v1.4.3</span>
      <span class="badge">Single Player • Loop</span>
      <span class="badge">No libraries • No logs</span>
    </div>

    <div class="tabs" role="tablist" aria-label="Anchors">
      <button class="tab active" data-artist="marina" role="tab" aria-selected="true">Marina</button>
      <button class="tab" data-artist="sigrid" role="tab">Sigrid</button>
      <button class="tab" data-artist="sabrina" role="tab">Sabrina</button>
      <button class="tab" data-artist="swift" role="tab">Swift</button>
      <button class="tab" data-artist="ariana" role="tab">Ariana</button>
      <button class="tab" data-artist="doechii" role="tab">Doechii</button>
      <button class="tab" data-artist="flow" role="tab" aria-controls="flow">FLOW</button>
    </div>

    <div class="controls" aria-label="Tone & Options">
      <button class="start" id="startAudio" aria-pressed="false">Enable Audio</button>
      <div class="switch" role="group" aria-label="Tone">
        <button data-freq="0"   class="active" aria-pressed="true">Off</button>
        <button data-freq="128">128 Hz</button>
        <button data-freq="160">160 Hz</button>
        <button data-freq="256">256 Hz</button>
      </div>
      <span class="chip">Mode:
        <button class="btn secondary" id="modeFlow" style="margin-left:8px">FLOW</button>
        <button class="btn" id="modeSpotlight">SPOTLIGHT</button>
      </span>
      <span class="chip" id="feelBadge">Feel Test: —</span>
      <span class="range">
        <label for="tintPct" class="mini">Tint %</label>
        <input id="tintPct" type="range" min="0" max="80" value="35" />
      </span>
    </div>
  </div>

  <!-- Queue Strip -->
  <section class="queuestrip" aria-label="Queue Strip">
    <div class="qhdr">
      <div>Queue: <strong id="queueName">—</strong></div>
      <div id="weekBadge">Week — • —</div>
    </div>
    <div class="qrow" id="queueStrip"></div>
    <div class="qmeta">
      <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn" id="playBtn">Play</button>
        <button class="btn secondary" id="pauseBtn">Pause</button>
        <button class="btn secondary" id="prevQ">Prev</button>
        <button class="btn" id="nextQ">Next</button>
        <select id="trackPicker" class="select" title="Select track"></select>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn secondary" id="rebuildQ" title="Rebuild playlist from current context">Rebuild</button>
        <a class="btn" id="openInYT" target="_blank" rel="noopener">Open in YouTube</a>
      </div>
    </div>
  </section>

  <div id="content" class="grid" aria-live="polite"></div>
</main>

<!-- Persistent Bottom Player (single player) -->
<div class="playerbar" id="playerbar">
  <div class="player-inner">
    <div class="player-title">Player <span class="pulse" id="tonePulse" title="Tone status"></span></div>
    <div class="player-iframe"><div id="ytframe"></div></div>
  </div>
</div>

<div class="footer" id="footer" style="padding: 16px 20px;">
  <div>
    © 2025 PLNT Earth — <em>froot.plnt.earth</em> • CC BY 4.0 • Music © respective artists; embedded for reference.
  </div>
  <div class="links">
    <a class="btn secondary" href="https://time.plnt.earth" target="_blank" rel="noopener">Back to χ</a>
    <a class="btn secondary" href="#" id="runFeel">Run 30-sec Feel Test</a>
  </div>
</div>

<script>
/* ===== DATA ===== */
var DATA = {
  marina:{ title:"Marina — Mirror / Butterfly",
    palettes:[
      {name:"Blue (Mirror)",hex:["#0E1C3A","#183C66","#1F5FA1","#2C82D3","#6AB6FF","#BFDFFF"],ritual:"Breathe 4–4–6. “Clarity is kind.”"},
      {name:"Pearl (Clarity)",hex:["#0E0F14","#1D2030","#2A3048","#B8C6DC","#E6EEF8","#F7FAFF"],ritual:"Palms on chest. “I tell the truth softly.”"},
      {name:"Violet (Victory)",hex:["#1A0F2A","#3A1E5A","#5A2E8A","#8C5FE0","#BCA8FF","#E9E2FF"],ritual:"Exhale through lips. “I take the stage.”"},
      {name:"Honey (Warmth)",hex:["#1A1202","#3D2606","#6B3E08","#A0640B","#F5B942","#FFE7B0"],ritual:"“Sweet on the tongue, steady in the core.”"},
      {name:"Air (Lift)",hex:["#0C1418","#0F2A33","#0F3D4C","#1B6A7A","#69C9D0","#C9F4F8"],ritual:"“I rise without effort.”"},
      {name:"Magnet (Draw)",hex:["#1B0E0E","#391414","#692020","#B53333","#FF6A6A","#FFD1D1"],ritual:"“What matches me arrives.”"}
    ],
    songs:[
      {t:"Froot",id:"WZzcY7ASQno"},{t:"Blue",id:"gDr7aTfBffU"},{t:"I'm a Ruin (I Am a Trier)",id:"ZT_skmohD-c"},
      {t:"Venus Fly Trap",id:"F1JTlnHGa90"},{t:"Oh No!",id:"Cr-SqRWImmI"},{t:"Happy",id:"s6AHxF0s764"},{t:"Butterfly",id:"aQMKAZpcynA"}
    ]},
  sigrid:{ title:"Sigrid — Clarity / Jellyfish",
    palettes:[
      {name:"Nord (Snow-Sea)",hex:["#0B1216","#10212A","#15313D","#2C5566","#7CC2D0","#E8FBFF"],ritual:"Side-breath. “Ocean in lungs.”"},
      {name:"Aurora (Blue-Green)",hex:["#0F1A13","#12281C","#17412C","#1F6845","#56B78E","#C9F2E1"],ritual:"Palm to nape. “I glow quiet.”"},
      {name:"Pearl Rose",hex:["#110E10","#221920","#3F2C3C","#7D597A","#E7C4E1","#FFEAF8"],ritual:"“Kind eyes, clear words.”"},
      {name:"Sky Milk",hex:["#0D0E11","#161821","#22263A","#6C76A8","#B8C1F0","#F0F3FF"],ritual:"Count 5 things, then close eyes."},
      {name:"Neon Snow",hex:["#090B13","#0E1730","#13275A","#3B6BFA","#8FB1FF","#E7EEFF"],ritual:"Trace a star and breathe."},
      {name:"Home Light",hex:["#0E1112","#1C2326","#2C383C","#51757C","#A4C9CE","#EFF7F8"],ritual:"“Steady as tide.”"}
    ],
    songs:[{t:"Strangers",id:"cIriwVhRPVA"},{t:"Don’t Feel Like Crying",id:"w5x93pXSmRM"},{t:"Mirror",id:"E7lr7pU9fYA"}]
  },
  sabrina:{ title:"Sabrina — Honey / Prism",
    palettes:[
      {name:"Prism Honey",hex:["#1A1202","#3D2606","#6B3E08","#A0640B","#F5B942","#FFF4C9"],ritual:"“Honey with boundaries.”"},
      {name:"Neon Peach",hex:["#1A0C08","#2E1812","#5A2C23","#C96548","#FF9E7C","#FFD7CA"],ritual:"Shimmy shoulders; “Joy moves me.”"},
      {name:"Stage Pink",hex:["#1C0E1A","#3B1840","#7C2E7A","#D552C0","#FF8CE6","#FFD9F7"],ritual:"Snap pulse 1-2-3-4."},
      {name:"Cool Mint",hex:["#0A1513","#0F2420","#174038","#2B6D60","#7FD7C1","#DFF9F2"],ritual:"Inhale cool; exhale warm."},
      {name:"Gold Film",hex:["#151107","#2C2511","#4A3E1C","#7C642C","#D8B663","#FFF0C8"],ritual:"“I shine and rest.”"},
      {name:"Night Pop",hex:["#0B0B12","#14182C","#222B55","#3D53A6","#8DA9FF","#DCE5FF"],ritual:"“Play is sacred.”"}
    ],
    songs:[{t:"Feather",id:"kLbn61Z4LDI"},{t:"Espresso",id:"eVli-tstM5E"},{t:"Please Please Please",id:"cF1Na4AIecM"},{t:"Nonsense",id:"YcSP1ZUf1eQ"},{t:"Fast Times",id:"Gla5AzlHnS4"}]
  },
  swift:{ title:"Taylor Swift — Story / Constellations",
    palettes:[
      {name:"Folklore Fog",hex:["#0D0E0F","#1A1C1E","#2A2D31","#6D7178","#B8BBC1","#EFF0F2"],ritual:"Name the chapter before sleep."},
      {name:"Midnight Ink",hex:["#0A0B12","#13162A","#1E2450","#33418D","#8AA0FF","#DDE4FF"],ritual:"Breathe once for each star you remember."},
      {name:"Red Thread",hex:["#190B0B","#351214","#5A1E22","#A5343B","#FF7A84","#FFD1D4"],ritual:"Touch wrist pulse; feel continuity."},
      {name:"Gold Pen",hex:["#141006","#272010","#44371B","#7B622D","#D5B367","#FFF0CC"],ritual:"Whisper a promise to self."},
      {name:"Green Meadow",hex:["#0E120F","#142219","#1D3A2A","#2F6248","#7DC19F","#DCF5E8"],ritual:"Exhale regret, inhale ease."},
      {name:"Blue Frame",hex:["#0B0E12","#0F1C2B","#18324A","#2C5A85","#78AEE2","#D7ECFF"],ritual:"Picture the safe room; step inside."}
    ],
    songs:[{t:"Love Story",id:"8xg3vE8Ie_E"},{t:"Cardigan (lyric version)",id:"zLSUp53y-HQ"},{t:"Anti-Hero",id:"b1kbLwvqugk"},{t:"Bejeweled",id:"b7QlX3yR2xs"}]
  },
  ariana:{ title:"Ariana — Voice / Resonance",
    palettes:[
      {name:"Resonance Blush",hex:["#150E0D","#2C1A18","#553430","#A36A5F","#F5B8A5","#FFEAE4"],ritual:"Inhale nose, exhale mouth; feel chest vibrate."},
      {name:"Silver Breath",hex:["#0E0E11","#1B1C25","#2E2F3D","#6E7083","#C7C9D5","#F3F4F8"],ritual:"Tilt chin; whisper your name like a lyric."},
      {name:"Peach Pulse",hex:["#120E0B","#251814","#3E2A25","#7B5146","#E4A18F","#FFE1D8"],ritual:"Two fingers to throat; hum until buzz."},
      {name:"Rose Air",hex:["#130E11","#251A21","#3F2A36","#7A556A","#DCA3BE","#FBE4F0"],ritual:"Smile faintly on the exhale."},
      {name:"Gold Quiet",hex:["#151107","#2A2312","#473D20","#7E6C3B","#D9BF7A","#FFF8D5"],ritual:"Hand to heart. Speak gently."},
      {name:"Voice Halo",hex:["#0B0C0D","#1A1C21","#30323A","#585C68","#B9BECF","#F0F3FA"],ritual:"Hear the note between notes."}
    ],
    songs:[{t:"yes, and?",id:"eB6txyhHFG4"},{t:"No Tears Left To Cry",id:"ffxKSjUwKdU"},{t:"POV (Live)",id:"fLFvbwrWLQY"},{t:"Positions",id:"tcYodQoapMg"}]
  },
  doechii:{ title:"Doechii — Neon / Trickster",
    palettes:[
      {name:"Neon Citrus",hex:["#101204","#1A2006","#2C360A","#4E6B12","#A5EC39","#EDFFD0"],ritual:"Tongue click + grin."},
      {name:"Ultraviolet",hex:["#120A1C","#26103B","#431B6A","#7A2BC0","#C27CFF","#F2E6FF"],ritual:"Surprise = life."},
      {name:"Street Glow",hex:["#0B0B0E","#141420","#232342","#4949A0","#9E9EF5","#E4E4FF"],ritual:"Look left/right/center."},
      {name:"Heat Lightning",hex:["#150F08","#2B1D0F","#4A331B","#7E5A2E","#E2AA66","#FFE9CC"],ritual:"Hands warm; mind cool."},
      {name:"Jade Flash",hex:["#0B110E","#102019","#1B3A2E","#2E644C","#6AC7A0","#D8FAEA"],ritual:"Exhale hiss."},
      {name:"Candy Riot",hex:["#130811","#2A0F22","#4D1B3E","#8E3576","#E26AB5","#FFD7EF"],ritual:"Silent laugh, release."}
    ],
    songs:[{t:"What It Is",id:"phtcAd8j6Ro"},{t:"Yucky Blucky Fruitcake",id:"8qnOpJfFfpU"},{t:"Stressed",id:"29mk5rz3m7Q"},{t:"Crazy (Live)",id:"L94niPkteGg"}]
  }
};

/* ===== GLOBAL STATE ===== */
var MODE = 'FLOW'; // 'FLOW' | 'SPOTLIGHT'
var SPOTLIGHT_ORDER = ["marina","sabrina","sigrid","ariana","swift","doechii"];
var FLOW_ORDER = ["marina","sigrid","sabrina","swift","ariana","doechii"];

var currentQueueIds=[], currentQueueTitles=[], currentContextName='—';
var currentFirstId="";
var player=null, playerReady=false;

/* ===== UTIL ===== */
function ytThumb(id){ return 'https://i.ytimg.com/vi/'+id+'/hqdefault.jpg'; }
function computeWeek(){ var d=window._FROOT_CYCLE_DAY||1; return computeWeekNumber(d); }
function updateWeekBadge(){
  var wk=computeWeek(), p=(window._FROOT_PHASE||'—'), badge=document.getElementById('weekBadge');
  if(badge) badge.textContent = "Week "+wk+" • "+p+" • Mode "+MODE;
}
function updateOpenInYT(){ var a=document.getElementById('openInYT'); if(a && currentFirstId){ a.href = "https://youtu.be/"+currentFirstId; } }
function setQueueName(name){ var el=document.getElementById('queueName'); if(el) el.textContent = name; }

/* ===== QUEUE BUILDERS ===== */
function setQueueFromAnchor(key){
  var ids = DATA[key].songs.map(function(s){return s.id;});
  var titles = DATA[key].songs.map(function(s){return s.t;});
  setQueueFromIds(ids, titles, DATA[key].title.split('—')[0].trim());
}
function buildFlow(){
  var maxLen = FLOW_ORDER.reduce(function(m,k){return Math.max(m, (DATA[k].songs||[]).length);}, 0);
  var ids=[], titles=[];
  for(var i=0;i<maxLen;i++){
    for(var j=0;j<FLOW_ORDER.length;j++){
      var k=FLOW_ORDER[j], s=(DATA[k].songs||[])[i];
      if(s){ ids.push(s.id); titles.push(k.charAt(0).toUpperCase()+k.slice(1)+": "+s.t); }
    }
  }
  var wk = computeWeek();
  var rot = Math.max(0, (wk-1) % (ids.length||1));
  if(rot>0){ ids = ids.slice(rot).concat(ids.slice(0,rot)); titles = titles.slice(rot).concat(titles.slice(0,rot)); }
  setQueueFromIds(ids, titles, "FLOW (Week "+wk+")");
}
function buildSpotlight(){
  var wk = computeWeek(); var idx = Math.max(0, (wk-1) % SPOTLIGHT_ORDER.length);
  var anchor = SPOTLIGHT_ORDER[idx];
  setQueueFromAnchor(anchor);
  setQueueName("SPOTLIGHT • "+DATA[anchor].title.split('—')[0].trim()+" (Week "+wk+")");
}
function setQueueFromIds(ids, titles, name){
  currentQueueIds = ids.slice(); currentQueueTitles = titles.slice();
  currentContextName = name||'—';
  currentFirstId = currentQueueIds[0] || "";
  updateOpenInYT();
  renderQueueStrip();
  setQueueName(currentContextName);
  loadIntoPlayer(); // refresh the single player with this playlist
  renderTrackPicker();
}
function renderQueueStrip(){
  var strip=document.getElementById('queueStrip'); strip.innerHTML='';
  for(var i=0;i<currentQueueIds.length;i++){
    var id=currentQueueIds[i], label=(i===0?'Now • ':'Next • ')+(currentQueueTitles[i]||'');
    var tile=document.createElement('div');
    tile.className='qtile'+(i>0?' small':'');
    tile.style.backgroundImage='url('+ytThumb(id)+')';
    tile.setAttribute('data-label', label);
    (function(ix){
      tile.addEventListener('click', function(){
        playIndex(ix);
      });
    })(i);
    strip.appendChild(tile);
  }
}
function renderTrackPicker(){
  var sel=document.getElementById('trackPicker'); if(!sel) return;
  sel.innerHTML='';
  currentQueueTitles.forEach(function(t,i){
    var opt=document.createElement('option'); opt.value=i; opt.textContent=(i+1)+". "+t; sel.appendChild(opt);
  });
  sel.onchange=function(){ var i=parseInt(this.value||'0',10); playIndex(i); };
}

/* ===== SINGLE PLAYER via YouTube IFrame API ===== */
function ensureYTAPI(){
  if(window.YT && window.YT.Player){ return true; }
  var tag=document.createElement('script'); tag.src="https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);
  return false;
}
function onYouTubeIframeAPIReady(){ createPlayer(); }
function createPlayer(){
  var frame = document.getElementById('ytframe');
  if(player){ try{ player.destroy(); }catch(_){ } player=null; }
  player = new YT.Player('ytframe', {
    height:'56', width:'100%',
    playerVars:{
      rel:0, modestbranding:1, playsinline:1, autoplay:1, color:'white',
      loop:1, // loop ON by default
      // playlist will be set after ready
    },
    events:{
      'onReady': function(){
        playerReady=true;
        loadIntoPlayer();
      },
      'onStateChange': function(e){
        // nothing extra; loop handled by playlist+loop flags
      }
    }
  });
}
function loadIntoPlayer(){
  if(!playerReady || !player || !currentQueueIds.length) return;
  // YouTube loop needs playlist param including the first id as well
  // Use loadPlaylist for API control; index 0; autoplay
  player.loadPlaylist({
    list: currentQueueIds.join(','),
    listType: 'playlist',
    index: 0,
    startSeconds: 0,
    suggestedQuality: 'default'
  });
  setTimeout(function(){ updateOpenInYT(); }, 300);
}
function play(){ if(playerReady && player){ player.playVideo(); } }
function pause(){ if(playerReady && player){ player.pauseVideo(); } }
function next(){ if(playerReady && player){ player.nextVideo(); setTimeout(updateOpenInYT,200); } }
function prev(){ if(playerReady && player){ player.previousVideo(); setTimeout(updateOpenInYT,200); } }
function playIndex(i){
  if(!playerReady || !player) return;
  if(i<0 || i>=currentQueueIds.length) return;
  player.playVideoAt(i);
  currentFirstId = currentQueueIds[i];
  updateOpenInYT();
  // keep "Now" tile visually first by rotating arrays
  if(i>0){
    currentQueueIds = currentQueueIds.slice(i).concat(currentQueueIds.slice(0,i));
    currentQueueTitles = currentQueueTitles.slice(i).concat(currentQueueTitles.slice(0,i));
    renderQueueStrip(); renderTrackPicker();
  }
}

/* ===== RENDERERS ===== */
var content=document.getElementById('content');
function renderVideos(artistKey){
  var group=document.createElement('section'); group.className='card'; group.innerHTML='<h2>Video Gallery</h2>';
  var vids=document.createElement('div'); vids.className='videos';

  var list = artistKey==="flow" ? buildFlowCards() : DATA[artistKey].songs.map(function(s){return {id:s.id,t:s.t,artist:artistKey};});
  list.forEach(function(item,i){
    var card=document.createElement('div'); card.className='vcard';
    var th=document.createElement('div'); th.className='thumb'; th.style.backgroundImage='url('+ytThumb(item.id)+')';
    var label=document.createElement('div'); label.className='vlabel';
    var titleTxt = (artistKey==="flow" ? (item.artist.toUpperCase()+": "+item.t) : item.t);
    label.innerHTML = '<span>'+titleTxt+'</span>'
      + '<span style="display:flex; gap:8px">'
      +   '<button class="setqueue" type="button" title="Set Queue to this context">Set Queue</button>'
      +   '<button class="playfirst" type="button" title="Play this first">Play</button>'
      + '</span>';
    th.appendChild(label); card.appendChild(th);

    label.querySelector('.setqueue').addEventListener('click', function(e){
      e.stopPropagation();
      if(artistKey==="flow"){ buildFlow(); }
      else{ setQueueFromAnchor(artistKey); }
      window.scrollTo({top:document.querySelector('.queuestrip').offsetTop-24, behavior:'smooth'});
    });
    label.querySelector('.playfirst').addEventListener('click', function(e){
      e.stopPropagation();
      // Put this id at front and reload
      var ids = artistKey==="flow" ? buildFlowCards().map(function(x){return x.id;}) : DATA[artistKey].songs.map(function(s){return s.id;});
      var titles = artistKey==="flow"
        ? buildFlowCards().map(function(x){return (x.artist.toUpperCase()+": "+x.t);})
        : DATA[artistKey].songs.map(function(s){return s.t;});
      var idx = ids.indexOf(item.id);
      if(idx>0){
        ids = ids.slice(idx).concat(ids.slice(0,idx));
        titles = titles.slice(idx).concat(titles.slice(0,idx));
      }
      setQueueFromIds(ids, titles, artistKey==="flow" ? "FLOW (custom)" : DATA[artistKey].title.split('—')[0].trim());
      play();
    });

    vids.appendChild(card);
  });
  group.appendChild(vids);
  content.appendChild(group);
}
function buildFlowCards(){
  var cards=[]; var maxLen=0;
  FLOW_ORDER.forEach(function(k){ maxLen=Math.max(maxLen, (DATA[k].songs||[]).length); });
  for(var i=0;i<maxLen;i++){
    FLOW_ORDER.forEach(function(k){
      var s=(DATA[k].songs||[])[i]; if(s){ cards.push({id:s.id,t:s.t,artist:k}); }
    });
  }
  return cards;
}
function renderArtist(key){
  content.innerHTML='';
  var d = key==="flow" ? {title:"FLOW — All Anchors Merged", lyric:"Week-aware rotation for seamless listening.", palettes:[]} : DATA[key];

  var card=document.createElement('section'); card.className='card';
  card.innerHTML='<h2>'+d.title+'</h2>'
    +'<div class="mini">'+(d.lyric||'')+'</div>'
    +'<div class="mini" style="margin-top:6px">'+ (key==="flow" ? 'Merged sequence evolves by current Illumina week.' :
      ('Palettes: '+d.palettes.length+' • Videos: '+d.songs.length)) +'</div>';
  content.appendChild(card);

  if(key!=="flow"){
    var pal=document.createElement('section'); pal.className='card'; pal.innerHTML='<h2>Palettes</h2>';
    var grid=document.createElement('div'); grid.className='palette'; pal.appendChild(grid);
    d.palettes.forEach(function(p){
      var sw=document.createElement('div'); sw.className='sw'; sw.setAttribute('title', p.name+' — click to tint + tone');
      sw.style.background='linear-gradient(90deg,'+p.hex.join(',')+')';
      var label=document.createElement('span'); label.textContent=p.name; sw.appendChild(label);
      sw.addEventListener('click', function(){
        var tintHex=p.hex[Math.min(4,p.hex.length-1)];
        setTint(tintHex); saveFeel(key, p.name);
        var base=p.name.split('(')[0].trim(); var f=FREQ_BY_NAME[base]||128; setFreq(f);
      });
      grid.appendChild(sw);
      var chips = p.hex.map(function(h){return '<span class="cchip" data-hex="'+h+'" title="Copy & preview">'+h+'</span>';}).join(' ');
      var wrap=document.createElement('div'); wrap.style.gridColumn='1 / -1'; wrap.style;marginBottom='8px';
      wrap.innerHTML = chips + '<div class="ritual">'+p.ritual+'</div>'; pal.appendChild(wrap);
    });
    content.appendChild(pal);
    content.querySelectorAll('.cchip').forEach(function(chip){
      chip.addEventListener('click', function(){
        var hex = chip.getAttribute('data-hex');
        navigator.clipboard && navigator.clipboard.writeText ? navigator.clipboard.writeText(hex) : null;
        var prev = getComputedStyle(document.documentElement).getPropertyValue('--tint');
        setTint(hex); setTimeout(function(){ setTint(prev || 'rgba(0,0,0,0)'); }, 2000);
      });
    });
  }

  renderVideos(key);
}

/* ===== Tone engine (AirPlay-safe) ===== */
var AC=null,osc=null,gain=null,started=false,currentFreq=0, dest=null, audioNode=null;
function ensureAudio(){
  if(AC) return true;
  try{
    AC = new (window.AudioContext||window.webkitAudioContext)();
    gain = AC.createGain(); gain.gain.value = 0.0;
    gain.connect(AC.destination);
    dest = AC.createMediaStreamDestination(); gain.connect(dest);
    audioNode = document.createElement('audio');
    audioNode.setAttribute('playsinline',''); audioNode.autoplay = true; audioNode.muted = false;
    audioNode.srcObject = dest.stream; audioNode.style.display='none'; document.body.appendChild(audioNode);
    return true;
  }catch(e){ return false; }
}
function unlockAudio(){
  if(!ensureAudio()) return;
  if(AC.state==='suspended'){ AC.resume(); }
  if(!started){
    osc = AC.createOscillator(); osc.type='sine'; osc.frequency.value=440; osc.connect(gain); osc.start(); started=true;
    var t=AC.currentTime; gain.gain.setTargetAtTime(0.18, t, 0.02); gain.gain.setTargetAtTime(0.0, t+0.18, 0.04);
  }
  var b=document.getElementById('startAudio'); if(b){ b.textContent='Audio Enabled'; b.setAttribute('aria-pressed','true'); }
}
function startTone(freq){
  if(!ensureAudio()) return;
  if(!started){ unlockAudio(); }
  var pulse=document.getElementById('tonePulse');
  if(freq>0){
    var t=AC.currentTime; osc.frequency.setValueAtTime(freq, t); gain.gain.cancelScheduledValues(t);
    gain.gain.setTargetAtTime(0.22, t, 0.05); currentFreq = freq; if(pulse) pulse.classList.add('on');
  }else{ stopTone(); }
}
function stopTone(){
  if(!AC || !started) return;
  var t=AC.currentTime; gain.gain.cancelScheduledValues(t); gain.gain.setTargetAtTime(0.0, t, 0.06);
  currentFreq = 0;
  document.querySelectorAll('.switch button').forEach(function(b){
    var f = parseInt(b.getAttribute('data-freq')||'0',10);
    b.classList.toggle('active', f===0); b.setAttribute('aria-pressed', f===0?'true':'false');
  });
  var pulse=document.getElementById('tonePulse'); if(pulse) pulse.classList.remove('on');
}
function setFreq(freq){ startTone(freq); }

/* ===== Feel Test ===== */
function saveFeel(artist, tag){ try{ localStorage.setItem('froot:feel:'+artist, tag); }catch(e){} var el=document.getElementById('feelBadge'); if(el) el.textContent='Feel Test: '+tag; }
function loadFeel(artist){ var el=document.getElementById('feelBadge'); var val=''; try{ val = localStorage.getItem('froot:feel:'+artist)||''; }catch(e){} if(el) el.textContent='Feel Test: '+(val||'—'); }

/* ===== UI wiring ===== */
document.getElementById('tintPct').addEventListener('input', function(){ document.documentElement.style.setProperty('--tintOpacity',(this.value/100).toString()); });
document.querySelectorAll('.switch button').forEach(function(b){
  b.addEventListener('click', function(){
    document.querySelectorAll('.switch button').forEach(function(x){ x.classList.remove('active'); x.setAttribute('aria-pressed','false'); });
    b.classList.add('active'); b.setAttribute('aria-pressed','true'); var f=parseInt(b.getAttribute('data-freq')||'0',10); setFreq(f);
  });
});
var startBtn=document.getElementById('startAudio'); if(startBtn){ startBtn.addEventListener('click', unlockAudio); }
/* Aggressive unlock for desktop */
['touchstart','touchend','mousedown','keydown','scroll'].forEach(function(ev){ document.addEventListener(ev, unlockAudio, {passive:true}); });

/* Mode buttons */
document.getElementById('modeFlow').addEventListener('click', function(){ MODE='FLOW'; this.classList.remove('secondary'); this.classList.add('btn'); document.getElementById('modeSpotlight').classList.add('secondary'); buildFlow(); updateWeekBadge(); });
document.getElementById('modeSpotlight').addEventListener('click', function(){ MODE='SPOTLIGHT'; this.classList.remove('secondary'); this.classList.add('btn'); document.getElementById('modeFlow').classList.add('secondary'); buildSpotlight(); updateWeekBadge(); });

/* Tab switching (content only; single player persists) */
document.querySelectorAll('.tab').forEach(function(t){
  t.addEventListener('click', function(){
    document.querySelectorAll('.tab').forEach(function(x){ x.classList.remove('active'); x.setAttribute('aria-selected','false'); });
    t.classList.add('active'); t.setAttribute('aria-selected','true');
    var artist = t.getAttribute('data-artist');
    renderArtist(artist);
  });
});

/* Queue control buttons */
document.getElementById('playBtn').addEventListener('click', play);
document.getElementById('pauseBtn').addEventListener('click', pause);
document.getElementById('nextQ').addEventListener('click', next);
document.getElementById('prevQ').addEventListener('click', prev);
document.getElementById('rebuildQ').addEventListener('click', function(){
  if(MODE==='FLOW') buildFlow(); else buildSpotlight();
});

/* Feel test */
var runFeel=document.getElementById('runFeel');
if(runFeel){ runFeel.addEventListener('click', function(e){
  e.preventDefault();
  var artist = document.querySelector('.tab.active').getAttribute('data-artist')||'marina';
  var list = (artist==="flow" ? [{name:"Blue"},{name:"Pearl"},{name:"Violet"}] : (DATA[artist].palettes||[]).slice(0,3));
  var i=0; var prog=document.createElement('div'); prog.style.position='fixed'; prog.style.left='50%'; prog.style.bottom='84px'; prog.style.transform='translateX(-50%)';
  prog.style.background='rgba(20,28,48,.9)'; prog.style.color='white'; prog.style.padding='8px 12px'; prog.style.border='1px solid var(--border)';
  prog.style.borderRadius='999px'; prog.style.fontSize='12px'; prog.style.zIndex='100'; document.body.appendChild(prog);
  function step(){
    if(i>=list.length){ stopTone(); saveFeel(artist,'✓'); prog.remove(); return; }
    var p=list[i++], base=(p.name||'Blue').split('(')[0].trim(); prog.textContent='Feel Test '+i+'/3 — '+base;
    var f=FREQ_BY_NAME[base]||128; setFreq(f); setTimeout(step, 10000);
  } step();
});}

/* Initial render + player bootstrap */
(function init(){
  renderArtist('marina');
  updateWeekBadge();
  if(!ensureYTAPI()){ /* script injected; onYouTubeIframeAPIReady will run */ }
  else{ createPlayer(); }
  // default mode: FLOW
  buildFlow();
})();
</script>
<script>
/* ===== Palette→frequency map ===== */
var FREQ_BY_NAME = {
  'Blue':128,'Pearl':160,'Violet':256,'Honey':128,'Air':160,'Magnet':256,
  'Nord':128,'Aurora':160,'Pearl Rose':160,'Sky Milk':256,'Neon Snow':256,'Home Light':128,
  'Prism Honey':128,'Neon Peach':160,'Stage Pink':256,'Cool Mint':160,'Gold Film':128,'Night Pop':256,
  'Folklore Fog':128,'Midnight Ink':256,'Red Thread':160,'Gold Pen':128,'Green Meadow':160,'Blue Frame':256,
  'Neon Citrus':160,'Ultraviolet':256,'Street Glow':256,'Heat Lightning':128,'Jade Flash':160,'Candy Riot':256,
  'Resonance Blush':160,'Silver Breath':256,'Peach Pulse':128,'Rose Air':160,'Gold Quiet':128,'Voice Halo':256
};
</script>
</body>
</html>
